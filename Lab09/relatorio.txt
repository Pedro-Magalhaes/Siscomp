ALUNO: Pedro Felipe Santos Magalhães – 1611074



QUESTÃO 1) Usando processos, escreva um programa C que 
implemente o problema do produtor/consumidor. 
Existem 2 consumidores.  O produtor e os 
consumidores devem compartilhar os recursos do 
processo (filas e demais dados). O produtor deve 
produzir dados (números inteiros) a cada 1 
segundo colocando-os em uma fila (buffer). Os 
consumidores devem retirar dados da fila a cada 2 
segundos. O tamanho máximo da fila deve ser de 
8 elementos (MAXFILA) e tanto o produtor como 
os dois consumidores devem produzir/consumir 
64 elementos
-----------------------------------------------------
ARQUIVO.C
/**Lab01.c **/

#include <stdio.h>
#include <stdlib.h>
#include <sys/shm.h>
#include <sys/stat.h>
#include <unistd.h>
#include <sys/wait.h>
#include <sys/msg.h>
#include <sys/ipc.h>
#define MAXFILA 8
#define MAXPRODUZIDO 64

typedef struct mymsg {
    long int    mtype;     /* message type */
    int        	meu_int;  /* message */
} mymsg;

int main (void)
{
	

	int pid_produtor,id_fila_msg;	
	mymsg m;
	struct msqid_ds buf;
	m.mtype = 1; //sei la o que fazer com esse type
	id_fila_msg = msgget(IPC_PRIVATE, IPC_CREAT | 0666);
	
	if(	msgctl(id_fila_msg,IPC_STAT,&buf) == -1)
	{
		printf("erro msgctl, saindo \n");
		exit(-1);
	}
	buf.msg_qbytes = 8 * sizeof(m.meu_int);
	if (msgctl(id_fila_msg,IPC_SET,&buf)==-1)
	{
		printf("erro setando msgctl, saindo \n");
		exit(-1);
	}
	
	pid_produtor=fork();	
	if (pid_produtor != 0) {			
		//consumidor 
		int i,status;					
		for(i=0;i<MAXPRODUZIDO;i++)
		{	
			sleep(2);
			status = msgrcv( id_fila_msg, &m, sizeof(m.meu_int)
, 1, 0); 
			printf("Mensagem recebida, meu i eh %d , e i do produtor era %d , deveriam ser iguais. status: %d \n",i,m.meu_int,status);
		}	
	
	} 
	else { //produtor
		
		int i,status;
		for(i=0;i<MAXPRODUZIDO;i++)
		{
			m.meu_int = i;
			status = msgsnd( id_fila_msg, &m, sizeof(m.meu_int), 0);
			printf("\n\nPRODUTOR: enviado %d, status: %d\n\n",m.meu_int,status);
				
			sleep(1);
		}

		printf("produtor acabou\n");
	}
	
	return 0;
}


-----------------------------------------------------

COMPILAÇÃO E EXECUÇÃO

c1611074@arpoador ~/Documents/pedro/Siscomp/Lab09$gcc -Wall -o l01 Lab01.c 
c1611074@arpoador ~/Documents/pedro/Siscomp/Lab09$./l01

-----------------------------------------------------
RESULTADO
/** só vou colocar parte da saida aqui pra não ficar gigante **/

c1611074@arpoador ~/Documents/pedro/Siscomp/Lab09$./l01


PRODUTOR: enviado 0, status: 0



PRODUTOR: enviado 1, status: 0

Mensagem recebida, meu i eh 0 , e i do produtor era 0 , deveriam ser iguais. status: 4 


PRODUTOR: enviado 2, status: 0



PRODUTOR: enviado 3, status: 0

Mensagem recebida, meu i eh 1 , e i do produtor era 1 , deveriam ser iguais. status: 4 


PRODUTOR: enviado 4, status: 0



PRODUTOR: enviado 5, status: 0

Mensagem recebida, meu i eh 2 , e i do produtor era 2 , deveriam ser iguais. status: 4 


PRODUTOR: enviado 6, status: 0



PRODUTOR: enviado 7, status: 0

Mensagem recebida, meu i eh 3 , e i do produtor era 3 , deveriam ser iguais. status: 4 


PRODUTOR: enviado 8, status: 0



PRODUTOR: enviado 9, status: 0 

Mensagem recebida, meu i eh 4 , e i do produtor era 4 , deveriam ser iguais. status: 4 


PRODUTOR: enviado 10, status: 0



PRODUTOR: enviado 11, status: 0

Mensagem recebida, meu i eh 5 , e i do produtor era 5 , deveriam ser iguais. status: 4 


PRODUTOR: enviado 12, status: 0

<<<<<<< ******** até aqui era assincrono e se torna sincrono ******>>>>>

PRODUTOR: enviado 13, status: 0

Mensagem recebida, meu i eh 6 , e i do produtor era 6 , deveriam ser iguais. status: 4 


PRODUTOR: enviado 14, status: 0

Mensagem recebida, meu i eh 7 , e i do produtor era 7 , deveriam ser iguais. status: 4 


PRODUTOR: enviado 15, status: 0

Mensagem recebida, meu i eh 8 , e i do produtor era 8 , deveriam ser iguais. status: 4 


PRODUTOR: enviado 16, status: 0

Mensagem recebida, meu i eh 9 , e i do produtor era 9 , deveriam ser iguais. status: 4 


PRODUTOR: enviado 17, status: 0

Mensagem recebida, meu i eh 10 , e i do produtor era 10 , deveriam ser iguais. status: 4 


PRODUTOR: enviado 18, status: 0

Mensagem recebida, meu i eh 11 , e i do produtor era 11 , deveriam ser iguais. status: 4 


PRODUTOR: enviado 19, status: 0

Mensagem recebida, meu i eh 12 , e i do produtor era 12 , deveriam ser iguais. status: 4 


PRODUTOR: enviado 20, status: 0

Mensagem recebida, meu i eh 13 , e i do produtor era 13 , deveriam ser iguais. status: 4 

-----------------------------------------------------
CONCLUSÃO
Tive dificuldade pra ver como setar o numero de bytes que a fila aceita

--------------------------------------------------------------

QUESTÃO 2) 
-----------------------------------------------------
ARQUIVO.C

-----------------------------------------------------

COMPILAÇÃO E EXECUÇÃO


-----------------------------------------------------
RESULTADO

-----------------------------------------------------
CONCLUSÃO
